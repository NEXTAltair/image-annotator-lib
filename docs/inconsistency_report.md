# image-annotator-lib ドキュメント・ルール矛盾点レポート


## 2. `Any`型の扱い

### 【ルール】
- `Any`型の使用は最小限、理由コメント必須。

### 【docs/REFERENCE/api.md】【developer_guide.md】
- `Any`型が型ヒント例やサンプルコードに頻繁に登場するが、理由コメントがない。

#### 【矛盾内容】
- `Any`型の使用理由が明記されていない箇所が複数存在。

#### 【推奨対応】
- `Any`型を使う場合は「なぜ具体的な型にできないか」理由コメントを必ず添える。
- 可能な限り具体的な型に置き換える。

---

## 3. ドキュメント更新・参照ルールの徹底

### 【ルール】
- コード・設計変更時は必ず関連ドキュメントを更新し、整合性を保つこと。
- `.cursor/rules/doc-lookup-rules.mdc` で「ドキュメント未更新・未参照は違反」と明記。

### 【memory-bank/decisionLog.md】【progress.md】
- ドキュメント統合・削減の決定や進捗が記録されているが、docs/README.md など一部ファイルのリンク修正や内容反映が未完了の可能性あり。

#### 【矛盾内容】
- 実際のファイルリンクや内容が最新状態か、定期的なクロスチェックが必要。
- 例：統合・削除されたファイルへのリンクが残っていないか、READMEのリンクが最新か。

#### 【推奨対応】
- ドキュメント統合・削除後は、全ファイルのリンク・内容を再点検し、古い参照を除去する。

---

## 4. `predict()` メソッドのオーバーライド禁止

### 【ルール】
- `.cursor/rules/image-annotator-lib/image-annotator-lib.mdc` および `memory-bank/activeContext.md` で「`BaseAnnotator.predict()` のオーバーライド禁止」と明記。

### 【developer_guide.md】【integrated_architecture.md】
- サンプル実装や説明で「predictメソッドは共通実装、オーバーライド禁止」と明記されているが、サンプルコードの一部で「predictをオーバーライドする」ような記述がないか要注意。

#### 【矛盾内容】
- 現状、明確な矛盾は見当たらないが、今後サンプル追加時に注意が必要。

---

## 5. モデル名・クラス名の命名規則

### 【ルール】
- クラス名は「*er」禁止、より具体的な名詞句を使う（例：`ModelLoad`, `InferenceRun`）。
- モデル名・ファイル名は小文字+アンダースコア。

### 【docs/REFERENCE/models.md】【configuration.md】
- 一部モデル名やクラス名が「*er」系（例：`WDTagger`, `BLIPTagger`）だが、これは既存有名モデル名のため例外的に許容されている様子。

#### 【矛盾内容】
- 新規実装時はルール厳守、既存有名モデルは例外扱いであることを明記すべき。

---

## 6. 設定ファイルパスの記載

### 【ルール】
- `memory-bank/productContext.md` で「パスはプロジェクトルートからの相対パスで統一」と明記。

### 【docs/REFERENCE/configuration.md】
- 設定ファイルのデフォルトパスが「src/image_annotator_lib/resources/system/annotator_config.toml」となっているが、他ドキュメントでは「config/annotator_config.toml」など複数表記が混在。

#### 【矛盾内容】
- 設定ファイルのパス表記が一貫していない。

#### 【推奨対応】
- パス表記を統一し、全ドキュメントで明確にする。

---

## 7. テストディレクトリ構造

### 【ルール】
- `.cursor/rules/directory-structure-rules.mdc` で「tests/unit/image_annotator_lib/」など厳密な構造を要求。

### 【developer_guide.md】
- テスト実行方法は記載されているが、ディレクトリ構造の厳密な説明がやや不足。

#### 【矛盾内容】
- テストディレクトリ構造の説明が全ドキュメントで統一されていない。

#### 【推奨対応】
- テストディレクトリ構造の説明を全ドキュメントで統一し、ルールへのリンクを明記。

---

# まとめ

- **型ヒント表記（Optional→| None）**
- **Any型の理由コメント**
- **ドキュメントリンク・内容の最新化**
- **設定ファイルパスの統一**
- **命名規則の例外明記**
- **テストディレクトリ構造の説明統一**

これらの点を修正・明記することで、ルールとドキュメントの整合性がさらに高まります。 