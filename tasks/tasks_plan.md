# タスク計画と進捗トラッカー

## バックログ / 今後の展望

- [ ] **新しいモデルタイプへの対応:**
    - 新しいタガーやスコアラーモデルを追加するためのアーキテクチャ拡張性を評価・実装する。
    - 具体的な候補モデルがあればリストアップする。
- [ ] **テスト拡充:**
    - **単体テスト:**
        - `ModelLoad` のキャッシュ戦略(LRU、CPU 退避、メモリ逼迫時の挙動)を検証するテストケースを追加。
        - 各フレームワーク別ローダー (`TransformersLoader`, `ONNXLoader` 等) の正常系・異常系テストを追加。
        - `registry.py` の動的クラス検出・登録ロジックのテストを追加。
        - 各具象モデルクラス (`models/` 配下) の主要メソッドに対するテストを追加・拡充。
    - **結合テスト (BDD 含む):**
        - `api.annotate` 関数のテストシナリオを拡充 (複数モデル同時実行、pHash 生成失敗ケース、エラーハンドリング、Web API モデルなど)。
        - 各モデルのエラーハンドリング (特に OOM, APIエラー) が `annotate` 関数レベルで適切に処理され、結果に反映されるか検証するシナリオを追加。
        - 設定ファイル (`annotator_config.toml`) の様々なパターン (オプション指定有無など) に対するテストを追加。
    - **カバレッジ:** `pytest --cov` を実行し、テストカバレッジを確認・向上させる。
- [ ] **モデル実装の最終確認:**
    - 各具象モデルクラス (`models/` 配下) のデフォルトパラメータ(閾値など)を確認し、必要であれば調整・ドキュメントに追記。
    - 特に Scorer 系のモデルの出力形式 (`tags` または `formatted_output`) が `AnnotationResult` の定義と整合しているか再確認。
- [ ] **ドキュメント最終化:**
    - `docs/` 内の各ドキュメント (API リファレンス、設定ガイド、モデル説明など) の内容を、最新のコード実装と完全に一致するように最終レビュー。
    - 全公開クラス・メソッド・関数の Docstring の網羅性と正確性を確認・修正。
    - 必要に応じてアーキテクチャ図などを `docs/` 内に追記・更新。
    - 日本語 README (`README-JP.md`) を作成または更新。
- [ ] **依存関係の最終整理:**
    - `pyproject.toml` の依存関係 (`dependencies`, `dev-dependencies`) を最終確認し、不要なライブラリがあれば削除。バージョン指定が適切か確認。
- [ ] **実環境での動作確認:**
    - ライブラリを実際に使用する環境 (例: LoRAIro) で `annotate` 関数を呼び出し、主要なモデルが問題なく動作するか確認。パフォーマンスやメモリ使用量についても簡易的に確認。
- [ ] **静的解析エラーの完全解消:**
    - `ruff check` および `mypy` を実行し、報告されるエラーや警告が完全に解消されていることを確認。(# type: ignore や # noqa が残っていないか確認)
- [ ] **設定ファイル (`annotator_config.toml`) の構造改善検討 (将来対応):**
    - 現在の `annotator_config.toml` の構造は読みにくいため、将来的に改善を検討する。具体的な改善案については別途相談する。

## 進行中のタスク


## 完了したタスク

- [x] ModelLoad のリファクタリングとメモリ管理ロジックの改善 (初期実装完了, 2024-04-02 -> 2025-04-05)
- [x] Memory Bank 更新 (当時の状況記録, 2025-04-05)
- [x] `memory-bank/` から推奨メモリファイルへの情報移行 (2025-04-29)
- [x] 設定ドキュメント (V2) に基づくファイル構造・ドキュメント整理 (主要部分完了, `memory-bank` 削除, `docs/` 内不要ファイル削除, 2025-04-30)
- [x] docs/ディレクトリのドキュメント整理・.gitignoreの見直し・models/ディレクトリ運用方針の明確化（2025-04-30）

## 既知の問題点

(ここに既知の問題点やバグを記載)